<script>function utilGetParameterByName(e,t){"undefined"==typeof t&&(t=window.location.search),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+e+"=([^&#]*)",o=new RegExp(a),r=o.exec(t);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function CollectionFilterHandleGet(){var e;return"/search"==window.location.pathname||"/"==window.location.pathname?"all":(e=window.location.pathname.substring("/collections/".length),e=e.split("/")[0])}function CollectionFilterSetProductDetailVariant(e,t){for(var a=[],o=0;o<t.length;o++)for(var r=0;r<e.options.length;r++){var i=e.options[r];i.name.toLowerCase()==t[o].option_name.toLowerCase()&&a.push({position:i.position,title:t[o].variant_title})}if(0!=a.length&&1!=e.variants.length)for(var o=0;o<e.variants.length;o++){var n=e.variants[o];if(!(n.title.indexOf("% Off")>-1||"shopify"==n.inventory_management&&"deny"==n.inventory_policy&&n.inventory_quantity<=0)){for(var s=!0,r=0;r<a.length;r++)n["option"+a[r].position]!=a[r].title&&(s=!1);if(s)return l("found_variant",n),void(window.location.href=window.location.pathname+"?variant="+n.id)}}}function CollectionFilterInitialize(){if("yes"==utilGetParameterByName("debug")&&console.log("CollectionFilterInitialize"),window.location.pathname.indexOf("/products/")>-1){if(""==utilGetParameterByName("variant")&&"object"==typeof simpleStorage.get("cf-app-selected-filters")){var e=simpleStorage.get("cf-app-selected-filters");e.length>0&&jQuery.getJSON(window.location.pathname+".json",function(t){CollectionFilterSetProductDetailVariant(t.product,e)})}}else{if("/search"==window.location.pathname||"/"==window.location.pathname);else if("/collections/"!=window.location.pathname.substring(0,"/collections/".length))return;var t=Math.floor((new Date).getTime()/1e3);"number"!=typeof simpleStorage.get("cf-last_update_hours")?CollectionFilterFlush():t-simpleStorage.get("cf-last_update_hours")>=600&&CollectionFilterFlush(),"undefined"==typeof simpleStorage.get("cf-app-remember-sort_by")&&simpleStorage.set("cf-app-remember-sort_by","",{TTL:6e5}),""!=utilGetParameterByName("sort_by")&&simpleStorage.set("cf-app-remember-sort_by",utilGetParameterByName("sort_by"),{TTL:6e5}),""!=utilGetParameterByName("view")&&simpleStorage.set("cf-app-remember-view",utilGetParameterByName("view"),{TTL:6e5});var a=CollectionFilterHandleGet();if("undefined"==typeof simpleStorage.get("cf-"+a)||"undefined"==typeof simpleStorage.get("cf-"+a).filters?jQuery.ajax({cache:!0,contentType:"application/json; charset=utf-8",dataType:"json",type:"GET",url:window.appcf.api_get,data:{shop:window.appcf.shop,handle:a},success:function(e){0!=e.filters.options.length&&0!=e.filters.options[0].values.length&&(simpleStorage.set("cf-"+a,e,{TTL:6e5}),simpleStorage.set("cf-last_update_hours",t,{TTL:6e5}),CollectionFilterCheckRemember(a),CollectionFilterPopulateOptions(a))}}):(CollectionFilterCheckRemember(a),CollectionFilterPopulateOptions(a)),"/search"==window.location.pathname){var o=CollectionFilterGetSearchValuesNoTags();jQuery("input[name='q']").val(o.join(" "))}}}function CollectionFilterSelectedFiltersGet(e){var t="",a=[];return t="/search"==window.location.pathname?utilGetParameterByName("q"):window.location.pathname.replace("/collections/"+e,"").replace("/",""),"string"==typeof t&&""!=t&&(t=decodeURIComponent(t),a=t.toLowerCase().split("+")),a}function CollectionFilterSetRemember(e,t){if("object"==typeof simpleStorage.get("cf-"+e)){"object"!=typeof simpleStorage.get("cf-app-remember-tags")&&simpleStorage.set("cf-app-remember-tags",[]);for(var a=simpleStorage.get("cf-app-remember-tags"),o=0;o<t.length;o++)t[o].indexOf("cf-size-")>-1&&a.indexOf(t[o])==-1&&a.push(t[o]);for(var r=[],i=simpleStorage.get("cf-"+e).filters.options,n=[],o=0;o<i.length;o++)for(var l=0;l<i[o].values.length;l++)n.push(i[o].values[l].tag);for(var o=0;o<a.length;o++)n.indexOf(a[o])>-1?t.indexOf(a[o])>-1&&r.push(a[o]):r.push(a[o]);simpleStorage.set("cf-app-remember-tags",r,{TTL:6e5})}}function CollectionFilterCheckRemember(e){if("/"!=window.location.pathname&&"/search"!=window.location.pathname){var t=CollectionFilterSelectedFiltersGet(e);"object"!=typeof simpleStorage.get("cf-app-remember-tags")&&simpleStorage.set("cf-app-remember-tags",[]);for(var a=simpleStorage.get("cf-app-remember-tags"),o=simpleStorage.get("cf-"+e).filters.options,r=[],i=0;i<o.length;i++)for(var n=0;n<o[i].values.length;n++)r.push(o[i].values[n].tag);for(var l=[],i=0;i<a.length;i++)r.indexOf(a[i])>-1&&t.indexOf(a[i].toLowerCase())==-1&&l.push(a[i]);0==l.length&&simpleStorage.get("cf-app-remember-sort_by")==utilGetParameterByName("sort_by")||(t.push.apply(t,l),CollectionFilterRedirect(e,t))}}function CollectionFilterPopulateOptions(e){"yes"==utilGetParameterByName("debug")&&console.log("CollectionFilterPopulateOptions",e);var t=simpleStorage.get("cf-"+e).filters.options,a=simpleStorage.get("cf-"+e).app_settings;simpleStorage.get("cf-"+e).created_days;"undefined"==typeof a.show_only_options&&(a.show_only_options=""),a.show_only_options=a.show_only_options.trim();var o=[];""!=a.show_only_options&&(o=a.show_only_options.split(","));var r="",i=CollectionFilterSelectedFiltersGet(e);if("undefined"==typeof a.appearance&&(a.appearance=[]),"undefined"==typeof a.production_mode&&(a.production_mode=!1),0==a.production_mode&&CollectionFilterFlush(),0==a.appearance.length)for(var n=0;n<o.length;n++)a.appearance.push({name:o[n],label:"",style:"select",all:""});var s=[];"yes"==utilGetParameterByName("debug")&&console.log("options",t,"app_settings",a);for(var p=0;p<a.appearance.length;p++){var c=a.appearance[p],m=t.filter(function(e){return e.name.toLowerCase()==c.name.toLowerCase()});if(1==m.length&&(m=m[0],"yes"==utilGetParameterByName("debug")&&l("option0",m),!(a.production_mode&&m.values.length<=1))){if(r+=" <span class='cf-label cf-title'>"+(""==c.label?c.name:c.label)+"</span>",r+=" <span class='cf-options-container'>",jQuery(window).width()<=720&&(c.style="select"),"select"==c.style){r+="<select class='cf-select'>",r+="<option value=''>"+("string"==typeof c.all?c.all:"")+"</option>";for(var u=0;u<m.values.length;u++)r+="<option value='"+m.values[u].tag+"' ",i.indexOf(m.values[u].tag.toLowerCase())>=0&&(r+=" selected",s.push({option_name:m.name,variant_title:m.values[u].name})),r+=">"+m.values[u].name+"</option>";r+="</select>"}if("checkboxes"==c.style){for(var f=!1,g="string"==typeof c.all?c.all:"",_="",u=0;u<m.values.length;u++){var d="cf-"+CollectionFilterConvertToSlug(c.name)+"-",h=m.values[u].tag.replace(d,"");_+="<label><input class='cf-checkbox' name='"+c.name+"[]' data-group-name='"+c.name+"' type='checkbox' value='"+m.values[u].tag+"' id='"+h+"'    ",_+=(i.indexOf(m.values[u].tag.toLowerCase())>=0?" checked ":"")+" > <span>"+m.values[u].name+"</span></label>",i.indexOf(m.values[u].tag.toLowerCase())>=0&&(f=!0,s.push({option_name:m.name,variant_title:m.values[u].name}))}""!=g&&(r+="<label><input class='cf-checkbox' name='"+c.name+"[]' data-group-name='"+c.name+"' type='checkbox' value='' id=''    ",0==f&&(r+=" checked "),r+=" > <span>"+g+"</span></label>"),r+=_}if("radios"==c.style){r+="<label><input class='cf-radio' data-group-name='"+c.name+"' type='radio' value='' ",r+=" > <span>"+("string"==typeof c.all?c.all:"View All")+"</span></label>";for(var u=0;u<m.values.length;u++)r+="<label><input class='cf-radio' data-group-name='"+c.name+"' type='radio' value='"+m.values[u].tag+"' ",r+=(i.indexOf(m.values[u].tag.toLowerCase())>=0?" checked ":"")+" > <span>"+m.values[u].name+"</span></label>",i.indexOf(m.values[u].tag.toLowerCase())>=0&&s.push({option_name:m.name,variant_title:m.values[u].name})}r+=" </span>"}}jQuery("#collection-filters-container").html(r),"yes"==utilGetParameterByName("debug")&&l("ohtml",r),setTimeout(function(){jQuery(".cf-select").bind("change",CollectionFilterChange),jQuery(".cf-checkbox").bind("change",CollectionFilterChange),jQuery(".cf-radio").bind("change",CollectionFilterChange),"yes"==utilGetParameterByName("debug"),"function"==typeof CollectionFilterReady&&CollectionFilterReady()},600),simpleStorage.set("cf-app-selected-filters",s,{TTL:36e5})}function CollectionFilterGetSearchValuesNoTags(){if("/search"!=window.location.pathname)return[];var e=[];""!=utilGetParameterByName("q")&&(e=utilGetParameterByName("q").split(" "));for(var t=[],a=0;a<e.length;a++)e[a].indexOf("tag:")==-1&&t.push(e[a]);return t}function CollectionFilterRedirect(e,t){if("/search"==window.location.pathname){for(var a=CollectionFilterGetSearchValuesNoTags(),o=0;o<t.length;o++)a.push("tag:"+t[o]);window.location="/search?type="+utilGetParameterByName("type")+"&q="+a.join("+")}else{var r="/collections/"+e+"/"+t.join("+");console.log("location_url",r),r=r.replace(/&/g,"%26");var i=utilGetParameterByName("sort_by");"undefined"!=typeof i&&""!=i||"undefined"!=typeof simpleStorage.get("cf-app-remember-sort_by")&&(i=simpleStorage.get("cf-app-remember-sort_by")),"undefined"==typeof i||""==i||(r+=r.indexOf("?")>-1?"&":"?",r+="sort_by="+i);var n=utilGetParameterByName("view");"undefined"!=typeof n&&""!=n||"undefined"!=typeof simpleStorage.get("cf-app-remember-view")&&(n=simpleStorage.get("cf-app-remember-view")),"undefined"==typeof i||""==n||(r+=r.indexOf("?")>-1?"&":"?",r+="view="+n),window.location.href=r}}function CollectionFilterChange(e){var t=jQuery(e.currentTarget).data("group-name"),a="",o=CollectionFilterHandleGet();"undefined"!=typeof t&&(a=jQuery(e.currentTarget).val());var r=[];jQuery(".cf-select").each(function(e){var t=jQuery(this).val();""!=t&&r.push(t)}),jQuery(".cf-checkbox:checked").each(function(e){var o=jQuery(this).val();""!=o&&(jQuery(this).data("group-name")!=t?r.push(o):o==a&&r.push(o))}),jQuery(".cf-radio:checked").each(function(e){var o=jQuery(this).val();""!=o&&(jQuery(this).data("group-name")!=t?""!=o&&r.push(o):o==a&&r.push(o))}),CollectionFilterSetRemember(o,r),CollectionFilterRedirect(o,r)}function CollectionFilterStart(){if("function"!=typeof jQuery)return console.log("please add jQuery to shop theme.liquid"),void setTimeout(function(){CollectionFilterStart()},800);if("number"!=typeof window.app_cf_started){window.app_cf_started=1,window.l=function(){};try{window.l=console.log.bind(console)}catch(e){}var e=utilGetParameterByName("env");window.appcf={shop:"{{shop.permanent_domain | remove: '.myshopify.com' }}",api_get:"https://collection-filter-www.herokuapp.com/api/v1/filters"},"dev"==e&&(window.appcf.api_get="https://localhost:5000/api/v1/filters"),CollectionFilterInitialize()}}function CollectionFilterFlush(){var e=simpleStorage.index().filter(function(e){return 0==e.indexOf("cf-")});e.map(function(e){simpleStorage.deleteKey(e)})}function CollectionFilterConvertToSlug(e){return e.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}!function(e,t){"use strict";e.simpleStorage=t()}(this,function(){"use strict";function e(){window.localStorage.setItem("__simpleStorageInitTest","tmpval"),window.localStorage.removeItem("__simpleStorageInitTest"),o(),n(),t(),"addEventListener"in window&&window.addEventListener("pageshow",function(e){e.persisted&&a()},!1),u=!0}function t(){"addEventListener"in window?window.addEventListener("storage",a,!1):document.attachEvent("onstorage",a)}function a(){try{o()}catch(e){return void(u=!1)}n()}function o(){var e=localStorage.getItem("simpleStorage");try{c=JSON.parse(e)||{}}catch(e){c={}}m=i()}function r(){try{localStorage.setItem("simpleStorage",JSON.stringify(c)),m=i()}catch(e){return e}return!0}function i(){var e=localStorage.getItem("simpleStorage");return e?String(e).length:0}function n(){var e,t,a,o,i,l=1/0,p=0;if(clearTimeout(f),c&&c.__simpleStorage_meta&&c.__simpleStorage_meta.TTL){for(e=+new Date,i=c.__simpleStorage_meta.TTL.keys||[],o=c.__simpleStorage_meta.TTL.expire||{},t=0,a=i.length;t<a;t++){if(!(o[i[t]]<=e)){o[i[t]]<l&&(l=o[i[t]]);break}p++,delete c[i[t]],delete o[i[t]]}l!=1/0&&(f=setTimeout(n,Math.min(l-e,2147483647))),p&&(i.splice(0,p),s(),r())}}function l(e,t){var a,o,r=+new Date,i=!1;if(t=Number(t)||0,0!==t){if(!c.hasOwnProperty(e))return!1;if(c.__simpleStorage_meta||(c.__simpleStorage_meta={}),c.__simpleStorage_meta.TTL||(c.__simpleStorage_meta.TTL={expire:{},keys:[]}),c.__simpleStorage_meta.TTL.expire[e]=r+t,c.__simpleStorage_meta.TTL.expire.hasOwnProperty(e))for(a=0,o=c.__simpleStorage_meta.TTL.keys.length;a<o;a++)c.__simpleStorage_meta.TTL.keys[a]==e&&c.__simpleStorage_meta.TTL.keys.splice(a);for(a=0,o=c.__simpleStorage_meta.TTL.keys.length;a<o;a++)if(c.__simpleStorage_meta.TTL.expire[c.__simpleStorage_meta.TTL.keys[a]]>r+t){c.__simpleStorage_meta.TTL.keys.splice(a,0,e),i=!0;break}i||c.__simpleStorage_meta.TTL.keys.push(e)}else if(c&&c.__simpleStorage_meta&&c.__simpleStorage_meta.TTL){if(c.__simpleStorage_meta.TTL.expire.hasOwnProperty(e))for(delete c.__simpleStorage_meta.TTL.expire[e],a=0,o=c.__simpleStorage_meta.TTL.keys.length;a<o;a++)if(c.__simpleStorage_meta.TTL.keys[a]==e){c.__simpleStorage_meta.TTL.keys.splice(a,1);break}s()}return clearTimeout(f),c&&c.__simpleStorage_meta&&c.__simpleStorage_meta.TTL&&c.__simpleStorage_meta.TTL.keys.length&&(f=setTimeout(n,Math.min(Math.max(c.__simpleStorage_meta.TTL.expire[c.__simpleStorage_meta.TTL.keys[0]]-r,0),2147483647))),!0}function s(){var e,t=!1,a=!1;if(!c||!c.__simpleStorage_meta)return t;c.__simpleStorage_meta.TTL&&!c.__simpleStorage_meta.TTL.keys.length&&(delete c.__simpleStorage_meta.TTL,t=!0);for(e in c.__simpleStorage_meta)if(c.__simpleStorage_meta.hasOwnProperty(e)){a=!0;break}return a||(delete c.__simpleStorage_meta,t=!0),t}var p="0.1.3",c=!1,m=0,u=!1,f=null;try{e()}catch(e){}return{version:p,canUse:function(){return!!u},set:function(e,t,a){if("__simpleStorage_meta"==e)return!1;if(!c)return!1;if("undefined"==typeof t)return this.deleteKey(e);a=a||{};try{t=JSON.parse(JSON.stringify(t))}catch(e){return e}return c[e]=t,l(e,a.TTL||0),r()},get:function(e){return!!c&&(c.hasOwnProperty(e)&&"__simpleStorage_meta"!=e&&this.getTTL(e)?c[e]:void 0)},deleteKey:function(e){return!!c&&(e in c&&(delete c[e],l(e,0),r()))},setTTL:function(e,t){return!!c&&(l(e,t),r())},getTTL:function(e){var t;return!!c&&(!!c.hasOwnProperty(e)&&(c.__simpleStorage_meta&&c.__simpleStorage_meta.TTL&&c.__simpleStorage_meta.TTL.expire&&c.__simpleStorage_meta.TTL.expire.hasOwnProperty(e)?(t=Math.max(c.__simpleStorage_meta.TTL.expire[e]-+new Date||0,0),t||!1):1/0))},flush:function(){if(!c)return!1;c={};try{return localStorage.removeItem("simpleStorage"),!0}catch(e){return e}},index:function(){if(!c)return!1;var e,t=[];for(e in c)c.hasOwnProperty(e)&&"__simpleStorage_meta"!=e&&t.push(e);return t},storageSize:function(){return m}}}),CollectionFilterStart();</script>
